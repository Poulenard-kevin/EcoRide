{% extends 'base.html.twig' %}

{% block title %}Fiche utilisateur - {{ user.email }}{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">
            <i class="bi bi-person-badge"></i> Fiche utilisateur
        </h1>

        <div class="d-flex gap-2">
            <a href="{{ path('app_admin_user_edit', {'id': user.id}) }}" class="btn btn-warning">
                <i class="bi bi-pencil"></i> Modifier
            </a>

            <form method="post" action="{{ path('app_admin_user_toggle', {id: user.id}) }}" onsubmit="return confirm('Confirmer la modification du statut ?');">
                <input type="hidden" name="_token" value="{{ csrf_token('toggle' ~ user.id) }}">
                {% if user.isActive() %}
                    <button class="btn btn-sm btn-secondary" type="submit">Suspendre</button>
                {% else %}
                    <button class="btn btn-sm btn-success" type="submit">Activer</button>
                {% endif %}
            </form>

            {% if app.user and app.user.id != user.id %}
                <form method="post" action="{{ path('app_admin_user_delete', {'id': user.id}) }}" style="display:inline;"
                      onsubmit="return confirm('Voulez-vous vraiment supprimer cet utilisateur ?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Supprimer
                    </button>
                </form>
            {% else %}
                <button class="btn btn-secondary" disabled title="Vous ne pouvez pas supprimer votre propre compte">
                    <i class="bi bi-lock"></i> Supprimer
                </button>
            {% endif %}
        </div>
    </div>

    <div class="card mb-3 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">{{ user.firstName }} {{ user.lastName }} <small class="text-muted">#{{ user.id }}</small></h5>

            <dl class="row mb-0">
                <dt class="col-sm-3">Email</dt>
                <dd class="col-sm-9"><a href="mailto:{{ user.email }}">{{ user.email }}</a></dd>

                <dt class="col-sm-3">Rôles</dt>
                <dd class="col-sm-9">
                    {% set role_labels = {
                        'ROLE_USER': 'Utilisateur',
                        'ROLE_EMPLOYE': 'Employé',
                        'ROLE_ADMIN': 'Administrateur'
                    } %}
                    {% for role in user.roles %}
                        {% if role == 'ROLE_ADMIN' %}
                            {% set badge_class = 'danger' %}
                        {% elseif role == 'ROLE_EMPLOYE' %}
                            {% set badge_class = 'info text-dark' %}
                        {% else %}
                            {% set badge_class = 'success' %}
                        {% endif %}
                        <span class="badge bg-{{ badge_class }}">{{ role_labels[role] ?? (role|replace({'ROLE_':''})|capitalize) }}</span>
                    {% endfor %}
                </dd>

                <dt class="col-sm-3">Inscription</dt>
                <dd class="col-sm-9">
                    {% if user.createdAt is defined and user.createdAt %}
                        {{ user.createdAt|date('d/m/Y à H:i') }}
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </dd>

                <dt class="col-sm-3">Statut</dt>
                <dd class="col-sm-9">
                    {% if user.isActive() %}
                        <span class="badge bg-success">Actif</span>
                    {% else %}
                        <span class="badge bg-danger">Suspendu</span>
                    {% endif %}
                </dd>

                {% if user.getAbout is defined or user.about is defined %}
                    <dt class="col-sm-3">À propos</dt>
                    <dd class="col-sm-9">{{ user.about ?: (user.getAbout() is defined ? user.getAbout() : '—') }}</dd>
                {% endif %}
            </dl>
        </div>
    </div>

    <a href="{{ path('app_admin_user_index') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Retour à la liste
    </a>
</div>
{% endblock %}